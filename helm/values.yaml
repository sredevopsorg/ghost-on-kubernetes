# yaml-language-server: $schema=./values.schema.json
# Default values for ghost-on-kubernetes

replicaCount: 1

image:
  repository: ghcr.io/sredevopsorg/ghost-on-kubernetes
  pullPolicy: Always
  tag: "main"

imagePullSecrets: []
nameOverride: ""
fullnameOverride: ""

# Ghost configuration
ghost:
  url: "https://yourdomain.tld"
  adminUrl: "https://yourdomain.tld"
  
  # Mail configuration
  mail:
    enabled: true
    transport: "SMTP"
    from: "user@server.com"
    service: "Google"
    host: "smtp.gmail.com"
    port: 465
    secure: true
    user: "user@server.com"
    password: "password"
  
  # Resource limits
  resources:
    limits:
      cpu: 800m
      memory: 800Mi
    requests:
      cpu: 100m
      memory: 256Mi

  # Probes configuration
  livenessProbe:
    enabled: false
    initialDelaySeconds: 30
    periodSeconds: 300
    timeoutSeconds: 3
    successThreshold: 1
    failureThreshold: 1
    
  readinessProbe:
    enabled: false
    initialDelaySeconds: 10
    periodSeconds: 10
    timeoutSeconds: 3
    successThreshold: 1
    failureThreshold: 3

  # Security context
  securityContext:
    readOnlyRootFilesystem: true
    allowPrivilegeEscalation: false
    runAsNonRoot: true
    runAsUser: 65532

  # Node affinity
  affinity:
    nodeAffinity:
      requiredDuringSchedulingIgnoredDuringExecution:
        nodeSelectorTerms:
          - matchExpressions:
              - key: node-role.kubernetes.io/worker
                operator: In
                values:
                  - 'true'

# MySQL configuration
mysql:
  # Enable/disable MySQL deployment
  enabled: true
  
  image:
    repository: docker.io/mysql
    tag: "8.4"
    pullPolicy: Always
  
  # Database credentials
  auth:
    database: "mysql-db-name"
    username: "mysql-db-user"
    password: "mysql-db-password"
    rootPassword: "mysql-db-root-password"
  
  # External database configuration (used when mysql.enabled=false)
  external:
    host: "external-mysql-host"
    port: 3306
    database: "ghost"
    username: "ghost"
    password: "changeme"
  
  # Resource limits
  resources:
    limits:
      cpu: 900m
      memory: 1Gi
    requests:
      cpu: 300m
      memory: 500Mi
  
  # Init container resources
  initResources:
    limits:
      cpu: 900m
      memory: 1Gi
    requests:
      cpu: 0m
      memory: 0Mi
  
  # Security context
  securityContext:
    readOnlyRootFilesystem: true
    allowPrivilegeEscalation: false
    runAsNonRoot: true
    runAsUser: 65534
  
  # Node affinity
  affinity:
    nodeAffinity:
      requiredDuringSchedulingIgnoredDuringExecution:
        nodeSelectorTerms:
          - matchExpressions:
              - key: node-role.kubernetes.io/worker
                operator: In
                values:
                  - 'true'

# Persistence configuration
persistence:
  ghost:
    enabled: true
    storageClassName: ""
    accessMode: ReadWriteOnce
    size: 1Gi
    # For HA, use ReadWriteMany (requires compatible storage class)
    # accessMode: ReadWriteMany
  
  mysql:
    enabled: true
    storageClassName: ""
    accessMode: ReadWriteOnce
    size: 1Gi

# Service configuration
service:
  type: ClusterIP
  port: 2368
  
  mysql:
    type: ClusterIP
    port: 3306

# Ingress configuration
ingress:
  enabled: true
  className: "traefik"
  
  # Ingress controller presets
  # Options: traefik, nginx, custom
  preset: "traefik"
  
  annotations: {}
    # For nginx:
    # kubernetes.io/ingress.class: nginx
    # cert-manager.io/cluster-issuer: letsencrypt-prod
    # For traefik:
    # traefik.ingress.kubernetes.io/router.entrypoints: websecure
  
  hosts:
    - host: yourdomain.tld
      paths:
        - path: /
          pathType: ImplementationSpecific
  
  tls:
    enabled: true
    # TLS mode: manual, certManager, or both
    mode: "manual"
    
    # For manual mode
    secretName: tls-secret
    
    # For cert-manager mode
    certManager:
      issuer: "letsencrypt-prod"
      issuerKind: "ClusterIssuer"
    
    # Manual certificate data (when mode=manual)
    certificate: ""
    key: ""
    
    hosts:
      - yourdomain.tld

# Init container configuration
initContainer:
  image:
    repository: docker.io/busybox
    tag: "stable-musl"
    pullPolicy: Always
  
  resources:
    limits:
      cpu: 900m
      memory: 1000Mi
    requests:
      cpu: 100m
      memory: 128Mi
  
  securityContext:
    readOnlyRootFilesystem: true
    allowPrivilegeEscalation: false

# Deployment strategy
strategy:
  type: RollingUpdate
  rollingUpdate:
    maxUnavailable: 0
    maxSurge: 3

# Additional volumes
volumes:
  tmp:
    sizeLimit: 64Mi
  mysqlTmp:
    sizeLimit: 128Mi
  mysqlSocket:
    sizeLimit: 128Mi

# Pod security context
podSecurityContext:
  seccompProfile:
    type: RuntimeDefault

# Service Account
serviceAccount:
  create: false
  automount: false
  annotations: {}
  name: ""

# Additional labels
labels: {}

# Additional annotations
annotations: {}
